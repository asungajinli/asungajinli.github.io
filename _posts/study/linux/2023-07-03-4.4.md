---
layout: single
title: "예제"
categories: Study Computer Linux
tag: Linux Ubuntu NS3 RAN-AI
toc: true
sidebar:
  title: "Linux"
  nav: linux
  parent: true
author_profile: false
image: /images/study/linux/4.4-1.png
---

# hello-simulator.cc

<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#24A091;font-weight:bold;">source code</span></summary>
<div markdown = "1">
  ```c++
  /* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */
  /*
    * This program is free software; you can redistribute it and/or modify
    * it under the terms of the GNU General Public License version 2 as
    * published by the Free Software Foundation;
    *
    * This program is distributed in the hope that it will be useful,
    * but WITHOUT ANY WARRANTY; without even the implied warranty of
    * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    * GNU General Public License for more details.
    *
    * You should have received a copy of the GNU General Public License
    * along with this program; if not, write to the Free Software
    * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    */

  #include "ns3/core-module.h"

  using namespace ns3;

  NS_LOG_COMPONENT_DEFINE ("HelloSimulator");

  int
  main (int argc, char *argv[])
  {
    NS_LOG_UNCOND ("Hello Simulator");
  }
  ```
</div>
</details>

<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#F0383B;font-weight:bold;">출력</span></summary>
<div markdown = "1">
```bash
Hello Simulator
```
</div>
<div style="width:50%;">
<img src="/images/study/linux/4.4-1.png" alt="build finished" class="gallery-img" width="100%"/>
</div>
</details>

# first.cc

기본 예제들을 모아놓은 /expample/tutorial 폴더 안에 first.cc 파일이 있다.<br>
first.cc 예제는 2개의 node를 point-to-point로 연결하는 시나리오이다.

<img src="/images/study/linux/4.4-2.png" class="gallery-img" width="30%">

<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#24A091;font-weight:bold;">source code</span></summary>
<div markdown = "1">

  ```c++
  /* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */
  /*********************************
  * 머리말 생략
  * GNU General Public License
  *********************************/

  #include "ns3/core-module.h"
  #include "ns3/network-module.h"
  #include "ns3/internet-module.h"
  #include "ns3/point-to-point-module.h"
  #include "ns3/applications-module.h"

  // Default Network Topology
  //
  //       10.1.1.0
  // n0 -------------- n1
  //    point-to-point
  //

  using namespace ns3;

  NS_LOG_COMPONENT_DEFINE ("FirstScriptExample");   // 로그 출력

  int
  main (int argc, char *argv[])
  {
    CommandLine cmd;
    cmd.Parse (argc, argv);

    /*********************************
    Time resolution 설정
    Echo Client와 Echo Server 애플리케이션에 내장된 두 개의 로깅 컴포넌트를 활성화
    디버그 로깅을 INFO 수준으로 활성화하여 시뮬레이션 중에 패킷이 전송되고 수신될 때 메시지를 출력
    *********************************/
    Time::SetResolution (Time::NS);   // Time resolution을 1ns로 설정 (default)
    LogComponentEnable ("UdpEchoClientApplication", LOG_LEVEL_INFO);
    LogComponentEnable ("UdpEchoServerApplication", LOG_LEVEL_INFO);

    NodeContainer nodes;
    nodes.Create (2);   // 노드 생성

    /*********************************
    채널 생성 및 토폴로지 구성
    구조: point-to-point
    *********************************/
    PointToPointHelper pointToPoint;
    pointToPoint.SetDeviceAttribute ("DataRate", StringValue ("5Mbps"));
    pointToPoint.SetChannelAttribute ("Delay", StringValue ("2ms"));

    /*********************************
    디바이스 생성, 구성 및 설치
    NodeContainer에서 각 노드에 대해 디바이스를 생성, 디바이스를 컨테이너에 저장, 채널을 생성 및 디바이스를 연결
    *********************************/
    NetDeviceContainer devices;
    devices = pointToPoint.Install (nodes);   // node와 NetDevice 연결

    /*********************************
    각 노드에 인터넷 프로토콜 스택 (TCP, UDP, IP 등) 설치
    *********************************/
    InternetStackHelper stack;
    stack.Install (nodes);

    /*********************************
    디바이스에 IP주소(IPv4) 할당
    base address와 네트워크 mask 설정
    기본저으로 할당된 주소는 1부터 시작하여 증가
    즉 첫버째 주소는 10.1.1.1, 다음은 10.1.1.2
    *********************************/
    Ipv4AddressHelper address;
    address.SetBase ("10.1.1.0", "255.255.255.0");

    Ipv4InterfaceContainer interfaces = address.Assign (devices);

    /*********************************
    생성한 노드 중 하나에 UDP echo server 애플리케이션 설정
    *********************************/
    UdpEchoServerHelper echoServer (9); // 포트 번호 9 설정

    ApplicationContainer serverApps = echoServer.Install (nodes.Get (1)); // index 1의 노드에 설치
    serverApps.Start (Seconds (1.0)); // 1초에 시작(활성화)
    serverApps.Stop (Seconds (10.0)); // 10초에 종료(비활성화)

    /*********************************
    노드에 설치할 클라이언트 에플리케이션을 설정해준다.
    이때 서버의 ip 주소와 포트 번호를 넘겨준다.
    *********************************/
    UdpEchoClientHelper echoClient (interfaces.GetAddress (1), 9); // 1번 노드의 주소와 9번 포트에 에코 클라이언트 생성
    echoClient.SetAttribute ("MaxPackets", UintegerValue (1)); // 최대 패킷 수를 1로 설정
    echoClient.SetAttribute ("Interval", TimeValue (Seconds (1.0))); // 패킷 전송 간격을 1초로 설정
    echoClient.SetAttribute ("PacketSize", UintegerValue (1024)); // 패킷 크기를 1024바이트로 설정

    ApplicationContainer clientApps = echoClient.Install (nodes.Get (0)); // index 0의 노드에 설치
    clientApps.Start (Seconds (2.0));
    clientApps.Stop (Seconds (10.0));

    /*********************************
    시뮬레이션 실행 및 종료
    *********************************/
    Simulator::Run ();
    Simulator::Destroy ();
    return 0;
  }
  ```
</div>
</details>
<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#F0383B;font-weight:bold;">출력</span></summary>
<div markdown = "1">
```bash
At time +2s client sent 1024 bytes to 10.1.1.2 port 9
At time +2.00369s server received 1024 bytes from 10.1.1.1 port 49153
At time +2.00369s server sent 1024 bytes to 10.1.1.1 port 49153
At time +2.00737s client received 1024 bytes from 10.1.1.2 port 9
```
</div>
<div style="width:50%;">
<img src="/images/study/linux/4.4-3.png" alt="build finished" class="gallery-img" width="100%"/>
</div>
</details>


# second.cc

second.cc는 여러개의 노드로 이루어진 네트워크 중 하나의 노드와 다른 노드가 p2p로 연결되어 있는 구조이다. 'node #0'이 'node #2~4'에는 직접 연결되어 있지 않지만 'node #1'을 통해 통신이 가능하다. 이 때 발생할 수 있는 collision도 이번 시나리오에 포함되어있다.

<img src="/images/study/linux/4.4-4.png" class="gallery-img" width="50%"/>

<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#24A091;font-weight:bold;">source code</span></summary>
<div markdown = "1">

  ```c++
  /* -*- Mode:C++; c-file-style:"gnu"; indent-tabs-mode:nil; -*- */
  /*********************************
  * 머리말 생략
  * GNU General Public License
  *********************************/

  #include "ns3/core-module.h"
  #include "ns3/network-module.h"
  #include "ns3/csma-module.h"
  #include "ns3/internet-module.h"
  #include "ns3/point-to-point-module.h"
  #include "ns3/applications-module.h"
  #include "ns3/ipv4-global-routing-helper.h"

  // Default Network Topology
  //
  //       10.1.1.0
  // n0 -------------- n1   n2   n3   n4
  //    point-to-point  |    |    |    |
  //                    ================
  //                      LAN 10.1.2.0


  using namespace ns3;

  NS_LOG_COMPONENT_DEFINE ("SecondScriptExample");

  int
  main (int argc, char *argv[])
  {
    bool verbose = true;
    uint32_t nCsma = 3; // LAN 내부 노드 개수

    /*********************************
    CommandLine 객체를 이용하여 커맨드라인에서 파라미터를 받아올 수 있다.
    아래 코드는 커맨드라인을 이용하여 1개의 네트워크 안에 몇개의 노드가 들어갈 것인지 입력한다. (기본값은 3)
    로그를 출력할지 말것인지도 커맨드라인을 통해 입력하다.
    *********************************/
    CommandLine cmd;
    cmd.AddValue ("nCsma", "Number of \"extra\" CSMA nodes/devices", nCsma);
    cmd.AddValue ("verbose", "Tell echo applications to log if true", verbose);

    cmd.Parse (argc,argv);

    // 만약 로그를 출력하기로 결정했다면 시나리오에서 사용하는 에플리케이션의 로그 레벨을 설정하여 로그가 출력될 수 있도록 한다.
    if (verbose)
      {
        LogComponentEnable ("UdpEchoClientApplication", LOG_LEVEL_INFO);
        LogComponentEnable ("UdpEchoServerApplication", LOG_LEVEL_INFO);
      }

    // 네트워크안에 1개의 노드는 있어야 point-to-point 링크를 사용하여 다른 노드와 연결할 수 있으므로 nCsma의 값이 1개 이상이 되도록 해준다.
    nCsma = nCsma == 0 ? 1 : nCsma;

    // 우선적으로 2개의 노드를 만든다. 이 노드 그룹을 p2pGroup라고 부르도록 하겠다.
    NodeContainer p2pNodes;
    p2pNodes.Create (2);

    /*********************************
    앞서 만든 2개의 노드중 2번째 노드를 포함하고 nCsma 만큼의 새로운 노드를 만든다. 이 노드 그룹을 csmaGroup라고 부르도록 하겠다.
    *********************************/
    NodeContainer csmaNodes;
    csmaNodes.Add (p2pNodes.Get (1));
    csmaNodes.Create (nCsma);

    /*********************************
    p2pGroup에 포함된 2개의 노드는 point-to-point 링크로 연결된다.
    point-to-point 링크는 5Mbps의 DataRate, 2ms의 Delay를 가진다.
    *********************************/
    PointToPointHelper pointToPoint;
    pointToPoint.SetDeviceAttribute ("DataRate", StringValue ("5Mbps"));
    pointToPoint.SetChannelAttribute ("Delay", StringValue ("2ms"));

    // point-to-point 링크를 이용하여 p2pGroup에 속한 노드를 연결한다.
    NetDeviceContainer p2pDevices;
    p2pDevices = pointToPoint.Install (p2pNodes);

    /*********************************
    CsmaHelper는 point-to-point 링크처럼 노드를 연결하는 링크로 point-to-point와의 차이점은 CSMA를 지원한다는 점이다.
    CsmaHelper는 100Mbps DataRate, 6560 nano second의 Delay를 가진다.
    *********************************/
    CsmaHelper csma;
    csma.SetChannelAttribute ("DataRate", StringValue ("100Mbps"));
    csma.SetChannelAttribute ("Delay", TimeValue (NanoSeconds (6560)));

    // csmaHelper 링크를 이용하여 csmaGroup에 속한 노드를 연결한다.
    NetDeviceContainer csmaDevices;
    csmaDevices = csma.Install (csmaNodes);

    // TCP/IP layer 역할을 하는 stack을 설치한다.
    InternetStackHelper stack;
    stack.Install (p2pNodes.Get (0));
    stack.Install (csmaNodes);

    // p2pGroup의 노드들은 10.1.1.0의 서브넷 아이디와 255.255.255.0 서브넷 마스크를 갖는다.
    Ipv4AddressHelper address;
    address.SetBase ("10.1.1.0", "255.255.255.0");
    Ipv4InterfaceContainer p2pInterfaces;
    p2pInterfaces = address.Assign (p2pDevices);

    // csmaGroup의 노드들은 10.1.2.0의 서브넷 아이디와 255.255.255.0 서브넷 마스크를 갖는다.
    address.SetBase ("10.1.2.0", "255.255.255.0");
    Ipv4InterfaceContainer csmaInterfaces;
    csmaInterfaces = address.Assign (csmaDevices);

    // 시나리오에서 사용할 서버 어플리케이션을 만든다.
    UdpEchoServerHelper echoServer (9);

    ApplicationContainer serverApps = echoServer.Install (csmaNodes.Get (nCsma)); // csmaGroup중 가장 마지막 노드에 서버 어플리케이션을 설치한다.
    serverApps.Start (Seconds (1.0)); // 서버 어플리케이션은 1초에 시작되고
    serverApps.Stop (Seconds (10.0)); // 10초에 종료된다.

    // 시나리오에서 사용할 클라이언트 어플리케이션을 만든다.
    UdpEchoClientHelper echoClient (csmaInterfaces.GetAddress (nCsma), 9);
    echoClient.SetAttribute ("MaxPackets", UintegerValue (1));  // 클라이언트 어플리케이션은 최대 1개의 패킷을 서버로 전송한다
    echoClient.SetAttribute ("Interval", TimeValue (Seconds (1.0)));  // 클라이언트 어플리케이션이 서버로 패킷을 전송하는 간격은 1초이다.
    echoClient.SetAttribute ("PacketSize", UintegerValue (1024)); // 클라이언트 어플리케이션이 전송하는 패킷의 크기는 1024Byte 이다.

    ApplicationContainer clientApps = echoClient.Install (p2pNodes.Get (0));  // p2pGroup의 첫번째 노드에 클라이언트 어플리케이션을 설치한다.
    clientApps.Start (Seconds (2.0)); // 클라이언트 어플리케이션은 2초에 시작하여
    clientApps.Stop (Seconds (10.0)); // 10초에 종료된다.

    Ipv4GlobalRoutingHelper::PopulateRoutingTables ();  // p2pGroup과 csmaGroup에 공통으로 속한 노드가 패킷을 받은 경우 어느 노드로 패킷을 전달해야하는지 알려준다.

    // 시나리오가 진행되는 동한 이동하는 패킷의 정보를 pcap의 형태로 남겨준다.
    pointToPoint.EnablePcapAll ("second");
    csma.EnablePcap ("second", csmaDevices.Get (1), true);

    Simulator::Run ();
    Simulator::Destroy ();
    return 0;
  }

  ```
</div>
</details>
<details style="margin:1em;">
<summary style="margin-bottom:0.5em;"><span style="color:#F0383B;font-weight:bold;">출력</span></summary>
<div markdown = "1">
```bash
At time +2s client sent 1024 bytes to 10.1.2.4 port 9
At time +2.0078s server received 1024 bytes from 10.1.1.1 port 49153
At time +2.0078s server sent 1024 bytes to 10.1.1.1 port 49153
At time +2.01761s client received 1024 bytes from 10.1.2.4 port 9
```
</details>

---

# Reference

[<a name="1">1</a>] [Damotorie의 공부, 개발 삽질기](https://parksjin01.github.io/){:target="_blank"}

[<a name="2">2</a>] [ns-3.33 tutorial 문서](https://www.nsnam.org/docs/release/3.33/tutorial/html/conceptual-overview.html#a-first-ns-3-script){:target="_blank"}